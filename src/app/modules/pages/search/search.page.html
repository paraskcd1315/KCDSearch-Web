<div class="flex flex-col gap-0">
  <app-search-header
    (onSearch)="onSearch($event)"
    (onClear)="onClear()"
    class="animate-fade-in-up header"
    [class.header-scrolled]="showHeaderBackground()"
  ></app-search-header>
  <mat-tab-group
    mat-stretch-tabs="false"
    mat-align-tabs="start"
    [selectedIndex]="activeTab()"
    (selectedTabChange)="onTabChange($event)"
  >
    @for (tab of tabs; track tab.value; let i = $index) {
      <mat-tab>
        <ng-template matTabLabel>
          <div class="flex items-center gap-2 animate-fade-in-up delay-1">
            <mat-icon [svgIcon]="tab.icon"></mat-icon>
            <span class="text-sm font-medium">{{ tab.label }}</span>
          </div>
        </ng-template>
        <div
          class="flex flex-col gap-4 tab-data"
          [class.h-dvh]="isLoading() && results().length === 0"
        >
          @if (isLoading()) {
            <mat-progress-bar mode="indeterminate" class="mx-auto"></mat-progress-bar>
          }
          @if (
            (results().length !== 0 || isMapTab()) && activeTab() === i && currentTabComponent()
          ) {
            <div
              class="animate-fade-in-up delay-2"
              [ngClass]="{
                'max-w-screen-xl lg:mx-auto 2xl:px-0 lg:px-20 px-8 py-8':
                  !isImageTab() && !isMapTab(),
              }"
            >
              <app-search-attributes
                class="flex items-center gap-4 pb-2"
                [ngClass]="{
                  'px-8 pt-8': isImageTab(),
                  hidden: results().length === 0 || isMapTab(),
                }"
              />
              <ng-container *ngComponentOutlet="currentTabComponent()"></ng-container>
            </div>
          } @else if (!isLoading()) {
            <div class="h-[calc(100dvh-9.9rem)] w-dvw flex justify-center items-center">
              No results found
            </div>
          }
        </div>
      </mat-tab>
    }
  </mat-tab-group>
  @if (selectedImageResult(); as result) {
    <app-search-image-result-detail
      (keydown.escape)="onCloseImageDetail()"
      (click)="onCloseImageDetail()"
    ></app-search-image-result-detail>
  }
</div>
